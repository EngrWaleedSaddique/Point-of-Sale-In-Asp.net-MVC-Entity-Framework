@model DropDownViewModels
<script src="~/Client/plugins/jquery-validation/jquery.validate.min.js"></script>
<div class="content-wrapper">
    <!-- pages navigates here -->
    <section class="content">
        <div class="row">
            <div class="col-xs-12 col-md-12 col-sm-12">
                <div class="box " id="print-section">
                    <div class="box-header">
                        <h3 class="box-title">
                            <i class="fa fa-plus" aria-hidden="true"></i>
                            Add New Product
                        </h3>
                    </div>
                    <form id="createProduct" method="post">
                        <div class="box-body ">
                            <h4 class="purchase-heading"> <i class="fa fa-check-circle"></i> Product Info</h4>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Product Name:</label>
                                        <input type="text" name="ProductName" value="" class="form-control input-lg" placeholder="e.g Panadol" reqiured="" />
                                    </div>
                                    <small>Name of the medicine or product ? </small>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Generic Name:</label>
                                        <input type="text" name="GenericName" value="" class="form-control input-lg" placeholder="e.g Paracetamol" reqiured="" />
                                    </div>
                                    <small>Name of the product ? </small>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Batch No:</label>
                                        <input type="text" name="BatchNo" value="" class="form-control input-lg" placeholder="e.g Batch No" reqiured="" />
                                    </div>
                                    <small>Sku or Batch No ?  </small>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Barcode:</label>
                                        <input type="text" name="BarCode" value="" id="barcode" class="form-control input-lg" placeholder="e.g 000025444255658" reqiured="" />
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>Description:</label>
                                        <textarea name="Description" class="form-control" rows="5"></textarea>
                                    </div>
                                </div>
                            </div>
                            <h4 class="purchase-heading"> <i class="fa fa-check-circle"></i> Medicine Type</h4>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label><a href="#" class="" data-toggle="modal" data-target="#MedicineTypeModal">(add Type)</a></label>
                                        <select class="form-control select2" name="MedicineTypeId" id="medicine_id" style="width: 100%;">
                                            <option value="">Select Type</option>
                                            @foreach (var type in Model.medicinesTypes)
                                            {
                                                <option value="@type.Id">@type.Name</option>
                                            }
                                        </select>

                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="box-body">
                            <h4 class="purchase-heading"> <i class="fa fa-check-circle"></i> Grouping</h4>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><a href="#" data-toggle="modal" data-target="#CompanyModal">(add Company)</a></label>
                                        <select class="form-control select2" name="CompanyId" id="company_id" style="width: 100%;">
                                            <option value="">Select Company</option>
                                            @foreach (var company in Model.companies)
                                            {
                                                <option value="@company.Id">@company.Name</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><a href="#" class="" data-toggle="modal" data-target="#DistributorModal">(add Distributor)</a></label>
                                        <select class="form-control select2" name="DistributorId" id="distributor_id" style="width: 100%;">
                                            <option value="">Select Distributor</option>
                                            @foreach (var distributor in Model.distributors)
                                            {
                                                <option value="@distributor.Id">@distributor.Name</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><a href="#" data-toggle="modal" data-target="#CategoryModal">(add Category)</a></label>
                                        <select class="form-control select2" name="CategoryId" id="category_id" style="width: 100%;">
                                            <option value="">Select Category</option>
                                            @foreach (var category in Model.categories)
                                            {
                                                <option value="@category.Id">@category.Name</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <h4 class="purchase-heading"><i class="fa fa-check-circle"></i> Extra information </h4>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Minimum stock level required:</label>
                                        <input type="number" name="MinStock" value="" class="form-control input-lg" placeholder="e.g 20" reqiured="" />
                                    </div>
                                    <small>Product alert indicator level ? </small>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Side Effects:</label>
                                        <input type="text" name="SideEffects" value="" class="form-control input-lg" id="sideeffects" placeholder="e.g avoid childrens" reqiured="" />
                                    </div>
                                    <small>Side effects of product ? </small>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Pack Size: </label>
                                        <input type="number" name="PackSize" value="" class="form-control input-lg" id="unit_per_pack" onkeyup="calculate_quantity()" placeholder="e.g 12" reqiured="" />
                                    </div>
                                    <small>Total number of products in each pack ? </small>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Unit Location in store: </label>
                                        <input type="text" name="Location" value="" class="form-control input-lg" placeholder="Top right corner" reqiured="" />
                                    </div>
                                    <small>Location where you stored this product in store. </small>
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <h4 class="purchase-heading"><i class="fa fa-check-circle"></i> Manufacturing & Expiry Date </h4>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Manufacturing Date :</label>
                                        <input type="date" name="ManufactureDate" value="" class="form-control input-lg" reqiured="" />
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Expiry Date :</label>
                                        <input type="date" name="ExpiryDate" value="" class="form-control input-lg" reqiured="" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <h4 class="purchase-heading"><i class="fa fa-check-circle"></i> Pricing & Costing </h4>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Unit Cost Price:</label>
                                        <input type="number" name="UnitCost" value="" class="form-control input-lg" step="any" />
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Unit Retail Price:</label>
                                        <input type="number" name="UnitRetail" value="" class="form-control input-lg" step="any" />
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Pack Cost Price:</label>
                                        <input type="number" name="PackCost" value="" class="form-control input-lg" step="any" />
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Retail Cost Price :</label>
                                        <input type="number" name="PackRetailCost" value="" class="form-control input-lg" step="any" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box-body">
                            <h4 class="purchase-heading"><i class="fa fa-check-circle"></i> Taxing % </h4>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Sales Tax% :</label>
                                        <input type="number" name="SalesTax" value="" class="form-control input-lg" placeholder="2.30" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box-body bg-setting-product">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <button id="saveBtn" name="saveBtn" class="btn btn-info btn-flat btn-lg pull-right" value="true"><i class="fa fa-floppy-o" aria-hidden="true"></i> Save Product</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</div>

@*Modal Section Start*@

<div class="modal fade" id="MedicineTypeModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h2>Add Product Type</h2></div>
            <div class="modal-body">
                <form id="supplierForm">
                    <label>Add Medicine Type</label><br />
                    <input type="text" class="form-control" id="medicineType" placeholder="Enter Type of Medicine" />
                </form>
            </div>
            <div class="modal-footer">
                <div class="btn-group">
                    <a href="#" id="btnSave" class="btn btn-primary mr-2">Save</a>
                    <a href="#" id="btnCancel" class="btn btn-danger">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="CompanyModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h2>Add Company</h2></div>
            <div class="modal-body">
                <form id="supplierForm">
                    <label>Add Company</label><br />
                    <input type="text" class="form-control" id="company" placeholder="Enter Company" />
                </form>
            </div>
            <div class="modal-footer">
                <div class="btn-group">
                    <a href="#" id="btnSaveCompany" class="btn btn-primary mr-2">Save</a>
                    <a href="#" id="btnCancelCompany" class="btn btn-danger">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="DistributorModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h2>Add Distributor</h2></div>
            <div class="modal-body">
                <form id="distributorForm">
                    <label>Add Distributor</label><br />
                    <input type="text" class="form-control" id="distributor" placeholder="Enter Distributor" />
                </form>
            </div>
            <div class="modal-footer">
                <div class="btn-group">
                    <a href="#" id="btnSaveDistributor" class="btn btn-primary mr-2">Save</a>
                    <a href="#" id="btnCancelDistributor" class="btn btn-danger">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="CategoryModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h2>Add Category</h2></div>
            <div class="modal-body">
                <form id="distributorForm">
                    <label>Add Category</label><br />
                    <input type="text" class="form-control" id="category" placeholder="Enter Category" />
                </form>
            </div>
            <div class="modal-footer">
                <div class="btn-group">
                    <a href="#" id="btnSaveCategory" class="btn btn-primary mr-2">Save</a>
                    <a href="#" id="btnCancelCategory" class="btn btn-danger">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>



@*Modal Section End*@
<script src="~/Client/dist/js/sweetalert.min.js"></script>
<!-- /.content-wrapper -->
<!-- ./wrapper -->
<script>
    //To use validate insert the juery validate library also.
    $('#createProduct').validate({
        rules: {
            ProductName: { required: true },//minlength: 1,//maxlength: 100},
            GenericName: { required: true, maxlength: 100 },
            BatchNo: { required: true, maxlength: 100 },
            BarCode: { required: true, maxlength: 100 },
            Description: { maxlength: 500 },
            Type: { required: true },
            CompanyId: { required: true },
            DistributorId: { required: true },
            CategoryId: { required: true },
            MinStock: { required: true },
            PackSize: { required: true },
            Location: { required: true },
            ManufactureDate: { required: true },
            ExpiryDate: { required: true },
            UnitCost: { required: true },
            UnitRetail: { required: true },
            PackCost: { required: true },
            PackRetailCost: { required: true }
            //price:{required: true,range: [1, 100000]}
        },
        messages:
        {
            ProductName: { required: 'Name is required', minlength: 'Minimum length is 1', maxlength: 'Maximum length is 50' },
            Description: { maxlength: 'Max length is 100' },
            GenericName: { required: 'Generice Name is required' },
            BatchNo: { required: 'Batch No is required' },
            BarCode: { required: 'BarCode is required' },
            Description: { required: 'Description is required' },
            CompanyId: { required: 'CompanyName is required' },
            DistributorId: { required: 'Distributor is required' },
            CategoryId: { required: 'Category is required' },
            MinStock: { required: 'MinStock is required' },
            PackSize: { required: 'PackSize is required' },
            Location: { required: 'Location is required' },
            ManufactureDate: { required: 'ManufactureDate is required' },
            ExpiryDate: { required: 'ExpiryDate is required' },
            UnitCost: { required: 'UnitCost is required' },
            UnitRetail: { required: 'UnitRetail is required' },
            PackCost: { required: 'PackCost is required' },
            PackRetailCost: { required: 'PackRetailCost is required' }
            //Price: {required: 'Price is required',range: 'Price must be available within 1-100000'}
        }
    }
    );


    $("#barcode").keypress(function (event) {
        if (event.which == '10' || event.which == '13') {
            event.preventDefault();
        }
    });

    $("#saveBtn").click(function () {

        if ($("#createProduct").valid()) {
            //event.preventDefualt is used to show the sweet alert if we not use this the sweet alert is disappear immediately.
            event.preventDefault();
            $.ajax(
                {
                    type: 'post',
                    url: '/Product/Create',
                    data: $("#createProduct").serialize()
                })
                .done(function (response) {

                }).fail(function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("Fail");
                });
            swal("Product Added!", "Product Added Successfully!", "success");
            $("#createProduct").trigger("reset");
        }
        else {
            swal({
                title: "Warning",
                text: "Please enter all valid data required fields",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            });
        }

    });
    $("#btnCancel").click(function () {
        $('#MedicineTypeModal').modal('toggle');
    });
    $("#btnCancelCompany").click(function () {
        $('#CompanyModal').modal('toggle');
    });
    $("#btnCancelDistributor").click(function () {
        $('#DistributorModal').modal('toggle');
    });
    $("#btnCancelCategory").click(function () {
        $('#CategoryModal').modal('toggle');
    });
    $("#btnSave").click(function () {
        $.ajax({
            type: "GET",
            url: "/Product/SaveMedicineType",
            data: { type: $("#medicineType").val() },
            success: function () {
                $.ajax({
                    type: "GET",
                    url: "/product/GetMedicineTypes",
                    success: function (data) {
                        $("#medicine_id").empty();
                        $('#MedicineTypeModal').modal('toggle');
                        for (var i = 0; i < data.length; i++) {
                            $("#medicine_id").append('<option selected="selected" value="' + data[i].Id + '">' + data[i].Name + '</option>');
                        }
                    }
                });
            }
        })

    });
    $("#btnSaveCompany").click(function () {
        $.ajax({
            type: "GET",
            url: "/Product/SaveCompany",
            data: { company: $("#company").val() },
            success: function () {
                $.ajax({
                    type: "GET",
                    url: "/product/showCompanyDropDownList",
                    success: function (data) {
                        $("#company_id").empty();
                        $('#CompanyModal').modal('toggle');
                        for (var i = 0; i < data.length; i++) {
                            debugger;
                                $("#company_id").append('<option selected="selected" value="'+data[i].Id+'">'+data[i].Name+'</option>');
                        }
                    }
                });
            }
        })
    });
    $("#btnSaveDistributor").click(function () {
        $.ajax({
            type: "GET",
            url: "/Product/SaveDistributor",
            data: { distributor: $("#distributor").val() },
            success: function () {
                $.ajax({
                    type: "GET",
                    url: "/product/GetDistributor",
                    success: function (data) {
                        $("#distributor_id").empty();
                        $('#DistributorModal').modal('toggle');
                        for (var i = 0; i < data.length; i++) {
                            
                            $("#distributor_id").append('<option selected="selected" value="' + data[i].Id + '">' + data[i].Name + '</option>');
                        }
                    }
                });
            }
        })
    });
    $("#btnSaveCategory").click(function () {
        
        $.ajax({
            type: "GET",
            url: "/Product/SaveCategory",
            data: { category: $("#category").val() },
            success: function () {
                $.ajax({
                    type: "GET",
                    url: "/product/GetCategories",
                    success: function (data) {
                        $("#category_id").empty();
                        $('#CategoryModal').modal('toggle');
                        for (var i = 0; i < data.length; i++) {
                            $("#category_id").append('<option selected="selected" value="' + data[i].Id + '">' + data[i].Name + '</option>');
                        }
                    }
                });
            }
        })
    });
</script>
